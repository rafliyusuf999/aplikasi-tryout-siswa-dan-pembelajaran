{% extends "base.html" %}

{% block title %}Kelola TO - Admin{% endblock %}

{% block content %}
<h1 style="color: var(--primary-color); margin-bottom: 2rem;">üìù Kelola Tes Online</h1>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2>Daftar TO</h2>
        <button onclick="showModal('addExamModal')" class="btn btn-primary">+ Tambah TO</button>
    </div>

    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Judul</th>
                    <th>Durasi</th>
                    <th>Soal</th>
                    <th>Jenis</th>
                    <th>Harga</th>
                    <th>Status</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody>
                {% for exam in exams %}
                <tr>
                    <td>{{ exam.title }}</td>
                    <td>{{ exam.duration_minutes }} menit</td>
                    <td>{{ exam.total_questions }}</td>
                    <td>{{ 'Premium' if exam.is_premium else 'Gratis' }}</td>
                    <td>Rp {{ exam.price if exam.is_premium else 0 }}</td>
                    <td>{{ 'Aktif' if exam.is_active else 'Nonaktif' }}</td>
                    <td>
                        <a href="{{ url_for('admin_questions', id=exam.id) }}" class="btn btn-primary" style="padding: 0.5rem 1rem; text-decoration: none; margin-right: 5px;">Soal</a>
                        <a href="{{ url_for('admin_view_essay_answers', exam_id=exam.id) }}" class="btn btn-secondary" style="padding: 0.5rem 1rem; text-decoration: none; margin-right: 5px;">Esai</a>
                        <a href="{{ url_for('leaderboard', exam_id=exam.id) }}" class="btn btn-success" style="padding: 0.5rem 1rem; text-decoration: none; margin-right: 5px;">Ranking</a>
                        <form method="POST" action="{{ url_for('admin_reset_exam_attempts', exam_id=exam.id) }}" style="display: inline;" onsubmit="return confirm('‚ö†Ô∏è PERINGATAN! Anda akan menghapus SEMUA attempt dan hasil siswa untuk TO ini. Siswa akan bisa mengerjakan TO ini lagi dari awal. Yakin?');">
                            <button type="submit" class="btn btn-warning" style="padding: 0.5rem 1rem; margin-right: 5px;">üîÑ Reset</button>
                        </form>
                        <form method="POST" action="{{ url_for('admin_delete_exam', id=exam.id) }}" style="display: inline;" data-confirm-delete>
                            <button type="submit" class="btn btn-danger" style="padding: 0.5rem 1rem;">Hapus</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div id="addExamModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Tambah TO Baru</h3>
            <span class="close" onclick="closeModal('addExamModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('admin_add_exam') }}">
            <div class="form-group">
                <label>Judul TO:</label>
                <input type="text" name="title" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Deskripsi:</label>
                <textarea name="description" class="form-control" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Durasi (menit):</label>
                <input type="number" name="duration_minutes" class="form-control" value="120" required>
            </div>
            <div class="form-group">
                <label>Jenis:</label>
                <select name="is_premium" class="form-control" required>
                    <option value="false">Gratis</option>
                    <option value="true">Premium</option>
                </select>
            </div>
            <div class="form-group">
                <label>Harga:</label>
                <input type="number" name="price" class="form-control" value="0">
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Tambah</button>
        </form>
    </div>
</div>
{% endblock %}
