{% extends "base.html" %}

{% block title %}Profil Saya - INSPIRANET OFFICIAL TO{% endblock %}

{% block content %}
<div class="card" style="max-width: 800px; margin: 2rem auto;">
    <h2 style="text-align: center; margin-bottom: 2rem;">üë§ Profil Saya</h2>
    
    <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 2rem;">
        {% if current_user.profile_photo %}
        <img src="{{ url_for('uploaded_file', filename='profiles/' + current_user.profile_photo) }}" 
             alt="{{ current_user.full_name }}" 
             style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; margin-bottom: 1rem; border: 4px solid var(--primary-color);">
        {% else %}
        <div style="width: 150px; height: 150px; border-radius: 50%; background: var(--primary-color); color: white; display: flex; align-items: center; justify-content: center; font-size: 4rem; margin-bottom: 1rem; border: 4px solid var(--primary-color);">
            {{ current_user.full_name[0].upper() }}
        </div>
        {% endif %}
        <h3>{{ current_user.full_name }}</h3>
        <p style="color: #666;">{{ current_user.role|title }}</p>
    </div>

    <form method="POST" action="{{ url_for('update_profile') }}" enctype="multipart/form-data">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div class="form-group">
                <label for="full_name">Nama Lengkap:</label>
                <input type="text" id="full_name" name="full_name" class="form-control" value="{{ current_user.full_name }}" required>
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" class="form-control" value="{{ current_user.email }}" required>
            </div>
        </div>

        <div class="form-group">
            <label for="password">Password Baru (Kosongkan jika tidak ingin mengubah):</label>
            <div style="position: relative;">
                <input type="password" id="password" name="password" class="form-control" minlength="6" placeholder="Masukkan password baru">
                <button type="button" onclick="togglePassword('password')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2rem;">
                    üëÅÔ∏è
                </button>
            </div>
            <small class="text-muted">Password minimal 6 karakter. Kosongkan jika tidak ingin mengubah.</small>
        </div>

        {% if current_user.role == 'student' %}
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div class="form-group">
                <label for="inspira_branch">Cabang:</label>
                <select id="inspira_branch" name="inspira_branch" class="form-control" required>
                    <option value="">Pilih Cabang</option>
                    {% for branch in branches %}
                    <option value="{{ branch }}" {% if current_user.inspira_branch == branch %}selected{% endif %}>{{ branch }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="class_level">Kelas:</label>
                <select id="class_level" name="class_level" class="form-control" required>
                    <option value="">Pilih Kelas</option>
                    {% for level in class_levels %}
                    <option value="{{ level }}" {% if current_user.class_level == level %}selected{% endif %}>{{ level }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div class="form-group">
                <label for="school_name">Nama Sekolah:</label>
                <input type="text" id="school_name" name="school_name" class="form-control" value="{{ current_user.school_name or '' }}" required>
            </div>
            <div class="form-group">
                <label for="phone_number">Nomor HP:</label>
                <input type="tel" id="phone_number" name="phone_number" class="form-control" value="{{ current_user.phone_number or '' }}" required>
            </div>
        </div>
        {% else %}
        <div class="form-group">
            <label for="phone_number">Nomor HP:</label>
            <input type="tel" id="phone_number" name="phone_number" class="form-control" value="{{ current_user.phone_number or '' }}" required>
        </div>
        {% endif %}

        <div class="form-group">
            <label for="profile_photo">Foto Profil Baru (Opsional):</label>
            <input type="file" id="profile_photo" name="profile_photo" accept="image/*" class="form-control">
            <small class="text-muted">Upload foto profil baru jika ingin mengubah (JPG, PNG, max 5MB)</small>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1.5rem;">
            <a href="{{ url_for('index') }}" class="btn btn-secondary" style="text-align: center; text-decoration: none; display: inline-block;">Batal</a>
            <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
        </div>
    </form>

    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #ddd;">
        <h3 style="margin-bottom: 1rem;">üìã Informasi Akun</h3>
        <div style="background: #f5f5f5; padding: 1rem; border-radius: 8px;">
            <p><strong>Email:</strong> {{ current_user.email }}</p>
            <p><strong>Nama:</strong> {{ current_user.full_name }}</p>
            <p><strong>Role:</strong> {{ current_user.role|title }}</p>
            {% if current_user.role == 'student' %}
            <p><strong>Cabang:</strong> {{ current_user.inspira_branch or '-' }}</p>
            <p><strong>Kelas:</strong> {{ current_user.class_level or '-' }}</p>
            <p><strong>Sekolah:</strong> {{ current_user.school_name or '-' }}</p>
            {% endif %}
            <p><strong>No HP:</strong> {{ current_user.phone_number or '-' }}</p>
            <p><strong>Tanggal Daftar:</strong> {{ current_user.created_at.strftime('%d %B %Y') if current_user.created_at else '-' }}</p>
            <p style="margin-bottom: 0;"><strong>Password:</strong> <span style="color: #666;">‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè</span> <small style="color: #999;">(Terenkripsi untuk keamanan)</small></p>
        </div>
    </div>
</div>

<script>
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const button = field.nextElementSibling;
    if (field.type === 'password') {
        field.type = 'text';
        button.textContent = 'üôà';
    } else {
        field.type = 'password';
        button.textContent = 'üëÅÔ∏è';
    }
}
</script>

<style>
@media (max-width: 768px) {
    div[style*="grid-template-columns: 1fr 1fr"] {
        grid-template-columns: 1fr !important;
    }
}
</style>
{% endblock %}
