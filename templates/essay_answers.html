{% extends "base.html" %}

{% block title %}Jawaban Esai - {{ exam.title }}{% endblock %}

{% block content %}
<div class="card">
    <h2 style="color: var(--primary-color);">üìù Jawaban Esai - {{ exam.title }}</h2>
    <p style="color: #666; margin-bottom: 2rem;">Review dan nilai jawaban esai siswa</p>
    
    {% if not essay_questions %}
    <div class="alert alert-info">
        <strong>‚ÑπÔ∏è Info:</strong> Tidak ada soal esai pada ujian ini.
    </div>
    {% else %}
    
    {% for attempt in attempts %}
    <div class="card" style="margin-bottom: 2rem; background: #f8f9fa;">
        <h4 style="color: var(--primary-color);">
            Siswa: {{ attempt.user.full_name }} 
            <span style="font-size: 0.9rem; color: #666;">({{ attempt.user.inspira_branch }})</span>
        </h4>
        <p style="color: #666;">
            Waktu: {{ attempt.finished_at.strftime('%d/%m/%Y %H:%M') if attempt.finished_at else 'Belum selesai' }} | 
            Skor: {{ attempt.total_score }}
        </p>
        
        {% if attempt.essay_answers %}
        {% set essay_dict = attempt.essay_answers|from_json %}
        
        {% for question in essay_questions %}
        <div class="question-card" style="margin-top: 1rem;">
            <h5>Soal #{{ question.question_order }}: {{ question.category }}</h5>
            <p><strong>{{ question.question_text }}</strong></p>
            
            {% if essay_dict.get(question.id|string) %}
            <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px;">
                <p><strong>Jawaban Siswa:</strong></p>
                <img src="{{ url_for('uploaded_file', filename='answers/' + essay_dict.get(question.id|string)) }}" 
                     style="max-width: 100%; border: 2px solid #ddd; border-radius: 8px; margin-top: 10px;">
            </div>
            {% else %}
            <p style="color: #dc3545; margin-top: 1rem;">‚ùå Tidak ada jawaban</p>
            {% endif %}
        </div>
        {% endfor %}
        
        {% else %}
        <p style="color: #666; margin-top: 1rem;">Tidak ada jawaban esai</p>
        {% endif %}
    </div>
    {% endfor %}
    
    {% if not attempts %}
    <div class="alert alert-info">
        <strong>‚ÑπÔ∏è Info:</strong> Belum ada siswa yang menyelesaikan ujian ini.
    </div>
    {% endif %}
    
    {% endif %}
    
    <div style="margin-top: 2rem;">
        <a href="{{ url_for('admin_exams') if current_user.role == 'admin' else url_for('teacher_exams') }}" 
           class="btn btn-secondary">‚Üê Kembali ke Daftar TO</a>
    </div>
</div>
{% endblock %}
