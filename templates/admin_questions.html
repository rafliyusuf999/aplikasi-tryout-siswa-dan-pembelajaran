{% extends "base.html" %}

{% block title %}Kelola Soal - {{ exam.title }}{% endblock %}

{% block content %}
<h1 style="color: var(--primary-color); margin-bottom: 2rem;">ðŸ“‹ Kelola Soal: {{ exam.title }}</h1>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2>Daftar Soal ({{ questions|length }})</h2>
        <button onclick="showModal('addQuestionModal')" class="btn btn-primary">+ Tambah Soal</button>
    </div>

    {% for question in questions %}
    <div class="question-card">
        <div style="display: flex; justify-content: space-between; align-items: start;">
            <div style="flex: 1;">
                <h4>Soal #{{ question.question_order }} - {{ question.category }} ({{ question.points }} poin)</h4>
                <p><strong>Tipe:</strong> {{ 'Pilihan Ganda' if question.question_type == 'multiple_choice' else 'Esai' }}</p>
                <p>{{ question.question_text }}</p>
                {% if question.question_type == 'multiple_choice' %}
                <div style="margin-top: 1rem;">
                    <p><strong>A.</strong> {{ question.option_a }}</p>
                    <p><strong>B.</strong> {{ question.option_b }}</p>
                    <p><strong>C.</strong> {{ question.option_c }}</p>
                    <p><strong>D.</strong> {{ question.option_d }}</p>
                    {% if question.option_e %}
                    <p><strong>E.</strong> {{ question.option_e }}</p>
                    {% endif %}
                    <p style="color: green; font-weight: bold;">Jawaban: {{ question.correct_answer }}</p>
                </div>
                {% endif %}
            </div>
            <div style="display: flex; gap: 0.5rem; margin-left: 1rem;">
                <button onclick="editQuestion({{ question.id }}, '{{ question.question_type }}', '{{ question.category|e }}', '{{ question.question_text|e }}', '{{ question.option_a|e }}', '{{ question.option_b|e }}', '{{ question.option_c|e }}', '{{ question.option_d|e }}', '{{ question.option_e|e }}', '{{ question.correct_answer }}', {{ question.points }})" class="btn btn-primary" style="padding: 0.5rem 1rem;">Edit</button>
                <form method="POST" action="{{ url_for('admin_delete_question', id=question.id) }}" style="display: inline;" onsubmit="return confirm('Yakin ingin menghapus soal ini?')">
                    <button type="submit" class="btn btn-danger" style="padding: 0.5rem 1rem;">Hapus</button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div id="addQuestionModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Tambah Soal Baru</h3>
            <span class="close" onclick="closeModal('addQuestionModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('admin_add_question', id=exam.id) }}">
            <div class="form-group">
                <label>Tipe Soal:</label>
                <select name="question_type" class="form-control" required onchange="toggleQuestionType(this)">
                    <option value="multiple_choice">Pilihan Ganda</option>
                    <option value="essay">Esai</option>
                </select>
            </div>
            <div class="form-group">
                <label>Kategori:</label>
                <input type="text" name="category" class="form-control" placeholder="Contoh: Matematika, Fisika" required>
            </div>
            <div class="form-group">
                <label>Pertanyaan:</label>
                <textarea name="question_text" class="form-control" rows="3" required></textarea>
            </div>
            <div id="mcOptions">
                <div class="form-group">
                    <label>Opsi A:</label>
                    <input type="text" name="option_a" class="form-control">
                </div>
                <div class="form-group">
                    <label>Opsi B:</label>
                    <input type="text" name="option_b" class="form-control">
                </div>
                <div class="form-group">
                    <label>Opsi C:</label>
                    <input type="text" name="option_c" class="form-control">
                </div>
                <div class="form-group">
                    <label>Opsi D:</label>
                    <input type="text" name="option_d" class="form-control">
                </div>
                <div class="form-group">
                    <label>Opsi E (Opsional):</label>
                    <input type="text" name="option_e" class="form-control">
                </div>
                <div class="form-group">
                    <label>Jawaban Benar:</label>
                    <select name="correct_answer" class="form-control">
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Poin:</label>
                <input type="number" name="points" class="form-control" value="1" min="1" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Tambah</button>
        </form>
    </div>
</div>

<div id="editQuestionModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Edit Soal</h3>
            <span class="close" onclick="closeModal('editQuestionModal')">&times;</span>
        </div>
        <form id="editQuestionForm" method="POST">
            <div class="form-group">
                <label>Tipe Soal:</label>
                <select name="question_type" id="edit_question_type" class="form-control" required onchange="toggleEditQuestionType(this)">
                    <option value="multiple_choice">Pilihan Ganda</option>
                    <option value="essay">Esai</option>
                </select>
            </div>
            <div class="form-group">
                <label>Kategori:</label>
                <input type="text" name="category" id="edit_category" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Pertanyaan:</label>
                <textarea name="question_text" id="edit_question_text" class="form-control" rows="3" required></textarea>
            </div>
            <div id="editMcOptions">
                <div class="form-group">
                    <label>Opsi A:</label>
                    <input type="text" name="option_a" id="edit_option_a" class="form-control">
                </div>
                <div class="form-group">
                    <label>Opsi B:</label>
                    <input type="text" name="option_b" id="edit_option_b" class="form-control">
                </div>
                <div class="form-group">
                    <label>Opsi C:</label>
                    <input type="text" name="option_c" id="edit_option_c" class="form-control">
                </div>
                <div class="form-group">
                    <label>Opsi D:</label>
                    <input type="text" name="option_d" id="edit_option_d" class="form-control">
                </div>
                <div class="form-group">
                    <label>Opsi E (Opsional):</label>
                    <input type="text" name="option_e" id="edit_option_e" class="form-control">
                </div>
                <div class="form-group">
                    <label>Jawaban Benar:</label>
                    <select name="correct_answer" id="edit_correct_answer" class="form-control">
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Poin:</label>
                <input type="number" name="points" id="edit_points" class="form-control" value="1" min="1" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Simpan Perubahan</button>
        </form>
    </div>
</div>

<script>
function toggleQuestionType(select) {
    const mcOptions = document.getElementById('mcOptions');
    if (select.value === 'essay') {
        mcOptions.style.display = 'none';
    } else {
        mcOptions.style.display = 'block';
    }
}

function toggleEditQuestionType(select) {
    const mcOptions = document.getElementById('editMcOptions');
    if (select.value === 'essay') {
        mcOptions.style.display = 'none';
    } else {
        mcOptions.style.display = 'block';
    }
}

function editQuestion(id, questionType, category, questionText, optionA, optionB, optionC, optionD, optionE, correctAnswer, points) {
    document.getElementById('editQuestionForm').action = '/admin/questions/' + id + '/edit';
    document.getElementById('edit_question_type').value = questionType;
    document.getElementById('edit_category').value = category || '';
    document.getElementById('edit_question_text').value = questionText || '';
    document.getElementById('edit_option_a').value = optionA || '';
    document.getElementById('edit_option_b').value = optionB || '';
    document.getElementById('edit_option_c').value = optionC || '';
    document.getElementById('edit_option_d').value = optionD || '';
    document.getElementById('edit_option_e').value = optionE || '';
    document.getElementById('edit_correct_answer').value = correctAnswer || 'A';
    document.getElementById('edit_points').value = points || 1;
    
    toggleEditQuestionType(document.getElementById('edit_question_type'));
    showModal('editQuestionModal');
}
</script>
{% endblock %}
